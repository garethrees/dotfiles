#!/usr/bin/env ruby
# Heavily based on http://leahneukirchen.org/repos/blogcode/mess.rb
require 'fileutils'
require 'date'

DOC_DIR = File.expand_path(File.join(ENV['HOME'], 'doc'))

current_dir = File.join(DOC_DIR, Date.today.strftime('%Y-%m'))
current_link = File.join(DOC_DIR, 'current')

FileUtils.mkdir_p(current_dir) unless File.directory?(current_dir)

if File.exist?(current_link) && !File.symlink?(current_link)
  warn "`#{current_link}' is not a symlink, something is wrong."
else
  if File.expand_path(current_link) != File.expand_path(current_dir)
    FileUtils.rm_f(current_link)
    FileUtils.ln_s(current_dir, current_link)
  end
end
